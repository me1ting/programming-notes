# 基本语法

一些需要熟悉的常见语法：

- 形式参数类型简写
- 无返回值，多返回值的语法形式
- `结果变量`（命名返回值）
- 参数按值传递
- 无函数体，表示native实现

# error

在Go中，error表示意料之中可能发生的非正常情况。Go使用控制流来处理错误。

处理错误的通用经验是：

- 可以在函数流之间传递错误，但每次都应该考虑是否需要附加必要的上下文信息，使用`:`串联，因此错误消息首字母不要大写
- 可以重试指定次数
- 可以记录日志
- 可以直接关闭程序
- 可以完全忽略

# 函数式编程

Go对函数式编程仅做有限的支持。

`函数变量`被支持，相关概念包括`函数表达式`/`匿名函数`、`函数类型`（形式参数类型列表和返回值类型列表称为函数签名）：

```
add := func (x, y int) int {
    return x + y
}
```

函数变量是一种`引用类型`，因为它可能引用了外部变量。

# 外部变量的陷阱

很容易就写出这样的代码：

```go
func main() {
	for i := 0; i < 9; i++ {
		go func() {
			fmt.Print(i, " ")
		}()
	}
	time.Sleep(5 * time.Second)
}
```

结果却可能输出这样的结果：

```
7 9 9 9 9 8 9 9 8
```

这是在支持外部变量的所有编程语言中常见的陷阱，**内部函数捕获的是外部变量，而非其值**，解决办法是使用局部变量存储值。

# 变长函数
```go
func sum(vals ...int) int {
}
```

接收变量为一`slice`，当无参传递时，值为nil。

在Python中有称为`解包`的语法，在Go中没有这样的定义，但有这样的形式：

```go
values := []int{1,2,3,4}
s := sum(values...)
```

*这个语法实际使用中较少，了解即可*

# defer

Go发明了`defer`这一语法，主要用于关闭资源。其特点是：

- 函数和参数立即求值，函数调用延迟执行
- 在函数体执行之后执行，包括`return`语句
- **可以修改结果变量**（如果返回指针，修改指向的值也能同时起到“改变返回值的效果”）
- 基于栈的执行模型

# panic

panic表示意料之外的非正常情况。

可以使用内置函数`panic`触发，通常也会调用`log.Fatial()`等方式间接触发。

可以使用特殊的流程进行恢复，参考书上的说明，但不推荐。
