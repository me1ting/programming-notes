# 读取目录下的所有文件名

读取目录是**文件IO**操作，存在阻塞，其执行模型可分为：

- 同步
- 异步

Node.js中提供了三种模型，其中有两种是异步模型：

- 阻塞+回调的同步模型
- 事件+回调的异步模型
- Pomise+await的异步模型

## 阻赛+回调的同步模型

在读取操作和回调执行完成之前，执行流都会停在该行直到完成。注意的是，**回调只是语法形式**，它并不能决定代码是同步还是异步执行。

```javascript
const testFolder = './tests/';
const fs = require('fs');

fs.readdirSync(testFolder).forEach(file => {
  console.log(file);
});
```

## 事件+回调的异步模型

```javascript
const testFolder = './tests/';
const fs = require('fs');

fs.readdir(testFolder, (err, files) => {
  files.forEach(file => {
    console.log(file);
  });
});
```

## Promise+await的异步模型

`Promise`是异步执行的核心，`await`和`callback`一样只属于语法形式，这里使用`await`实现编写近似同步的代码，使得代码的可读性、可写性更好。

可以看到Promise+异步函数结合了前两者的优点，更值得使用。

```javascript
/*import是ESCAScript的标准语法，require是node.js的方言*/
import {
    readdir
} from 'node:fs/promises';

try {
    const files = await readdir(testFolder);
    for (const file of files) {
        if (file.endsWith(testcasesSuffix)&&!file.endsWith(resSuffix)) {
            test(file);
        }
    }
} catch (err) {
    console.error(err);
}
```

## ref

https://stackoverflow.com/questions/2727167/how-do-you-get-a-list-of-the-names-of-all-files-present-in-a-directory-in-node-j