# 概览

JavaScript的主要运行环境是浏览器，且原本不支持`模块`，导致后续更新的模块存在晦涩难懂的缺点。

本文将大致梳理一下JavaScript现有的模块系统。

# 模块的相关概念

## 模块化编程

`模块`是`模块化编程`的直接体现，模块化编程的思想是：

*将大型软件拆分为一个个由接口拼接而成的部分，接口契约使得代码的功能得以保证，而模块化使得代码的编写、测试、维护更加容易*。

## 其它通用概念

模块化编程在实践过程中存在一些**通用的概念**，但是大多数编程语言都没有明确的介绍这些概念，是因为这些概念一部分被自然的接受，一部分属于编译器、解释器领域知识。

但JavaScript现有的状况，导致我们或多或少会接触到这些概念：

//more

# ES6之前的模块实现

除了`Node.js`中还残留有ES6之前的一些模块实现的痕迹，大部分旧的第三方模块实现已经被ES6的模块系统取代，而IT领域的考古目前没有什么实际价值，因此可以不用了解。

# ES6模块

## HTML中的模块标签

浏览器中的JavaScript代码都是在HTML页面中声明的，现在可以声明为模块：

```html
<!--可以是内嵌代码，或者外部文件-->
<script type="module"></script>
```

这带来的影响是**改变传统的JavaScript代码执行模式**。传统情况下浏览器在解析HTML时遇到JavaScript脚本会**同步**下载、解析、运行，而现在遇到JavaScript模块会异步下载、解析，并在解析完HTML文档后按照先后顺序依次执行。

`async`会**进一步改变JavaScript模块执行模式**，在异步加载、解析JavaScript模块的基础上，异步执行JavaScript模块。

## Node.js中的模块

Node.js环境也支持ES6模块标准：

- 一个模块项目对外界而言是一个模块（编译结果是一个模块）
- 项目中每个独立的`.js`文件是项目的子模块

> 由于主要运行环境是浏览器，通过在HTML页面中使用标签来使用JavaScript代码，JavaScript目前并没有提供`包`概念，以及更复杂的代码组织功能。

## 导入、导出、重导出

`导出`：声明本模块的公开接口信息

`导入`：声明本模块使用到的外部模块的信息

`重导出`：将其它模块的公开的接口信息作为本模块的公开接口信息进行声明

### 导出

相比于`C++`,`Java`的复杂隐私模型，JavaScript只有两种`隐私权限`（类似`Go`）：

- 公开，可以被外部模块使用
- 非公开，只能在模块内部使用

默认隐私权限是`非公开`，通过关键字`export`将标志导出为公开才能被外部模块使用。

```javascript
export function doSomething() {
}
```

> JavaScript目前使用术语`命名导出`来称呼普通导出功能，使用术语`默认导出`来称呼后面将介绍的特殊导出功能，除了增加记忆负担外，并没有什么亮点。

### 默认导出

JavaScript的模块有一个特殊的标志名`default`，是一个`关键字`。

> 记住即可，为什么采用这种设计还有待进一步了解。
>
> 这样的设计虽然没太大用处，但也有一些用处，比如：`Vue`中使用`default`来导出其Vue组件对象。

### 导入

导入的基本语句如下：

```javascript
import cube from './my-module.js';
```

核心包括：

- `标志`：导入到本模块中使用的名称，可以使用`别名`
- `源模块`：一般使用`文件路径`；使用npm或其他包管理器管理的项目，可以使用`模块名称`

> 由于源模块主要使用**文件路径**来确定，这导致在JavaScript中不存在这样的情况：**模块名**作为合法标志在代码中使用。
>
> 这是JavaScript模块系统不同于其它语言的最大区别之一。

比如：

```go
// 在大部分语言中，都支持使用包名/模块名作为一个合法标志在代码中使用
// 而这在JavaScript中是不支持的
import "fmt"
func main(){
    fmt.Println("Hello world!")
}
```

### 重导出

示例如下：

```javascript
export cube from './my-module.js';
```

# 总结

由于先天不足（主要运行环境是浏览器，最初没有考虑模块化），JavaScript后续增加的模块系统没有什么亮点。

由于与传统编程语言的模块系统存在着语法差异，导致需要花费精力去理解，增加额外的记忆负担：

- 使用`export`语句而非`权限修饰符`
- 不支持`模块名`作为合法标志
- 支持`default`导出

# Refs

《JavaScript高级程序设计 4》20. 模块
