# 简介

## 领域驱动设计

这里不是介绍领域驱动设计是啥（我也还没弄明白），只需要知道Spring Data是基于这个设计理念的。

因此Spring使用了DDD的一些专有名称`repository`,`entity`..

## Repository

`Repository`表示数据的访问接口，一般常用的使它的子接口`CrudRepository`和`PagingAndSortingRepository`。

```java
public interface CrudRepository<T, ID> extends Repository<T, ID> {
  <S extends T> S save(S entity);
  Optional<T> findById(ID primaryKey);
  Iterable<T> findAll();
  long count();
  void delete(T entity);
  boolean existsById(ID primaryKey);
  // … more functionality omitted.
}

public interface PagingAndSortingRepository<T, ID>  {
  Iterable<T> findAll(Sort sort);
  Page<T> findAll(Pageable pageable);
}
```

### 定义Repository

我们要定义访问特定实体的Repository，这是通过定义接口实现：

```java
// 定义了一个UserRepository，User是实体类型，Long是id类型
interface UserRepository extends MyBaseRepository<User, Long> {
  User findByEmailAddress(EmailAddress emailAddress);
}
```

Java配置类上的`@EnableJdbcRepositories`注解向框架声明了需要激活哪些Repository接口。

```java
@Configuration
@EnableJdbcRepositories`
class ApplicationConfiguration{}
```

### 查询方法

Spring Data使用内置的`查询生成器`根据接口方法名称创建约束查询：

```java
interface PersonRepository extends Repository<Person, Long> {

  List<Person> findByEmailAddressAndLastname(EmailAddress emailAddress, String lastname);
  // Enables the distinct flag for the query
  List<Person> findDistinctPeopleByLastnameOrFirstname(String lastname, String firstname);
  // Enabling ignoring case for an individual property
  List<Person> findByLastnameIgnoreCase(String lastname);
  // Enabling static ORDER BY for a query
  List<Person> findByLastnameOrderByFirstnameAsc(String lastname);
}
```

其规则细节见[文档](https://docs.spring.io/spring-data/relational/reference/repositories/query-methods-details.html)说明。

