# 概览

TypeScript给JavaScript带来了静态类型系统，这是任何一个接触过TypeScript的开发者都了解的事情。

让人感兴趣的是，TypeScript是如何设计这个静态类型系统的。由于类型在编译时被完全擦除，TypeScript中的类型是JavaScript之上的一层简单的约束，是一组共同点的[集合](https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-oop.html#types-as-sets)。

在TypeScript中，更多的是在形式参数上使用类型来作为约定，并不强制值也具有明确的类型，而只要其满足形式参数的需求，这是TypeScript与传统编译型语言Java等最大的不同。

# 常见类型

JavaScript中存在类型，但是**不显式使用类型**，而TypeScript中可以显式使用类型。

## number,string,boolean

JavaScript存在这些类型，但是无法显式声明类型。

## 数组

在TypeScript中[数组](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#arrays)具有显式的类型：`type[]`(如`string[]`)或者泛型的形式`Array<type>`。

## any

表示任意类型，意味着不执行静态类型检查，你可以在any类型变量上执行任何操作，或将any变量的值赋值给任意类型而不触发编译时错误。

# 类型注释

显式指定变量的类型：

```typescript
let myName: string = "Alice";
```

大多数情况下，我们不需要使用`类型注释`，TypeScript编译器会根据上下文进行`类型推导`。

# 函数

带类型注释的函数，`参数的类型注释`和`返回值的类型注释`都是可选，但建议都带上。

```typescript
function half(n: number): number {
  return n/2;
}
```

> 匿名函数是个特例，通常不需要带上参数类型

# 对象类型

与后述的`联合类型`一样，对象类型在形式参数中通常使用`类型字面量`的形式，而非命名的类型。

```typescript
function printCoord(pt: { x: number; y: number }) {
  console.log("The coordinate's x value is " + pt.x);
  console.log("The coordinate's y value is " + pt.y);
}
```

## 可选属性

对象类型的部分或全部属性可以是可选的：

```typescript
function printName(obj: { first: string; last?: string }) {
  // ...
}
```

根据JavaScript的语义：访问不存在的属性会返回`undefined`，可能会导致运行时错误。


# 联合类型

TypeScript提供了`Union`类型：

```typescript
function printId(id: number | string) {
  console.log("Your ID is: " + id);
}
```

默认情况下，对Union类型的合法操作是所有可能类型的操作的**交集**。

可以[缩小](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#working-with-union-types)Union可能的实际类型，来使用特定类型的合法操作：

- `typeof`可以用来限定实际类型
- `Array.isArray`可以用来限定实际类型

比如：

```typescript
function getUser(id: number): User|null {
  //return user by id or null if not found target user
}

function work(){
  let user = getUser();
  if(user === null){

  }else{
    //user is a User
  }
}
```

>\<\<handbook\>\>使用一篇[长文](https://www.typescriptlang.org/docs/handbook/2/narrowing.html)来讲解**缩小**这一行为的背后逻辑，除非你确实感到了困惑，不推荐提前去看这部分内容。

# 类型别名

在传统编译型语言(如Java,Go...)中，**类型依附于名称而被使用**，在TypeScript中**类型的名称并非必须**。由于TypeScript的类型系统是在JavaScript之上构建的，TypeScript采取“鸭子类型”，只要具有相同的结构就是相同的类型，因此采用[类型别名](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#type-aliases)术语来描述类型的名称。

# 接口

TypeScript中的[接口](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#interfaces)语义不同于我们所见过的传统OOP语言，是用来**命名对象类型的一种方法**（类型别名是另一种方法）。

```typescript
interface Point {
  x: number;
  y: number;
}
```

# 类型断言

[类型断言](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#type-assertions)是某种意义上的强制类型转换，使用`as`关键字·。

```typescript
const myCanvas = document.getElementById("main_canvas") as HTMLCanvasElement;
```

某些场景，编译器检测无法进行类型转换，但使用者保证可以合法类型转换，需要使用小技巧：

```typescript
const a = expr as any as T;
const a = expr as unknown as T;//更推荐
```

# 字面量类型

`字面量类型`是TypeScript所**特有**的，类型为字面量本身（一般为`string`或`number`），且只有唯一值本身：

```typescript
// "hello"是字面量类型，该类型存在唯一值"hello"
let x: "hello" = "hello";
```

其**唯一**的用处就是通过Union来实现**枚举类型**：

```typescript
function printText(s: string, alignment: "left" | "right" | "center") {
  // ...
}
```

> TypeScript有独立的[枚举类型](https://www.typescriptlang.org/docs/handbook/enums.html)，这里的“枚举”实现价值在于：更加轻量简洁

## 常量接口

这部分逻辑比较杂乱，个人理解这部分包括两个内容：

- 在JavaScript中，`const`用于值为对象类型的变量时，表示变量指向的对象无法改变，而对象的字段是可以改变的，TypeScript沿用该规定。
- 普通变量值传递给`字面量类型`需要使用`as const`语法进行转换（编辑器会提示）

# null&undefined

在TypeScript这两个值都有同名的确切类型。

## strictNullChecks选项

该[选项](https://www.typescriptlang.org/tsconfig#strictNullChecks)控制TypeScript中`null`与`undefined`的表现。

首先，建议开启该选项。

关闭该选项时，`null`与`undefined`是任意类型合法的值，就像在Java,C#以及JavaScript中那样，需要使用者在访问前进行检测。

开启该选项时，`null`与`undefined`无法作为非any类型的值。你应当使用`Union`类型来表示可能存在这两种或任意一种情况，此时需要使用者在访问前进行检测。

```typescript
function doSomething(x: string | null) {
  if (x === null) {
    // do nothing
  } else {
    //do something
  }
}
```

## 非空断言运算符

如果用户能够确定可能为空的类型，其值使用时不为空，那么可以使用该运算符让编译器视为非空（如果错误，会导致运行时异常）。

```typescript
function liveDangerously(x?: number | null) {
  // 编译器不会报错，但运行时可能报错
  console.log(x!.toFixed());
}
```

# 枚举

...

# Refs

《handbook》 [类型](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html)

